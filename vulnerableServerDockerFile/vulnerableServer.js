const axios = require('axios');
const { json } = require('express');
const express = require('express')
const server = express();

server.use(json());

const client = axios.default;
const port = 3001;

async function getByAxios(url, maxContentLength) {
  try {
    const response = await client.get(url, {maxContentLength});
    console.log(`O conteÃºdo desta resposta tem ${JSON.stringify(response.data).length} bytes`);
    return response.data;
  }
  catch (err) {
    console.log(err);
  }
}

server.post('/', async (req, res) => {
  const { url } = req.body;
  const maxContentLength = Number(process.argv[2]);
  const response = await getByAxios(url, maxContentLength);
  res.send(response);
});

server.listen(port);