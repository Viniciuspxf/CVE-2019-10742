const axios = require('axios');
const { json } = require('express');
const express = require('express')
const server = express();
require('dotenv').config({path: __dirname + '/.env'})

server.use(json());

const client = axios.default;
const port = 3000;

async function getByAxios(url, maxContentLength) {
  try {
    const response = await client.get(url, {maxContentLength});
    console.log(`O conteÃºdo desta resposta tem ${JSON.stringify(response.data).length} bytes`);
    return response.data;
  }
  catch (err) {
    console.log(err);
  }
}

server.post('/', async (req, res) => {
  const { url } = req.body;
  const maxContentLength = Number(process.env.MAX_CONTENT_SIZE);
  const response = await getByAxios(url, maxContentLength);
  res.send(response);
});

console.log(`Listening on port ${port}... \n
              Max content size=${process.env.MAX_CONTENT_SIZE}`)
server.listen(port);